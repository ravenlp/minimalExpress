{"version":3,"sources":["../src/db.js"],"names":["connectDb","mongoose","connect","process","env","DATABASE_URL","statsSchema","Schema","domain","type","String","count","Number","statics","addOneOrCreate","hostname","Stats","findOneAndUpdate","$inc","new","useFindAndModify","create","model"],"mappings":";;;;;;;AAAA;;;;AAEA,MAAMA,SAAS,GAAG,MAAM;AACpB,SAAOC,kBAASC,OAAT,CAAiBC,OAAO,CAACC,GAAR,CAAYC,YAA7B,CAAP;AACH,CAFD;;;AAIA,MAAMC,WAAW,GAAG,IAAIL,kBAASM,MAAb,CAAoB;AACpCC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAEC;AADF,GAD4B;AAIpCC,EAAAA,KAAK,EAAE;AACHF,IAAAA,IAAI,EAAEG;AADH;AAJ6B,CAApB,CAApB;AASA;;;;AAGAN,WAAW,CAACO,OAAZ,CAAoBC,cAApB,GAAqC,eAAeA,cAAf,CAA8BC,QAA9B,EAAwC;AACzE,MAAIP,MAAM,GAAG,MAAMQ,KAAK,CAACC,gBAAN,CAAuB;AAACT,IAAAA,MAAM,EAAEO;AAAT,GAAvB,EAA2C;AAAEG,IAAAA,IAAI,EAAE;AAAEP,MAAAA,KAAK,EAAE;AAAT;AAAR,GAA3C,EAAmE;AAACQ,IAAAA,GAAG,EAAE,IAAN;AAAYC,IAAAA,gBAAgB,EAAE;AAA9B,GAAnE,CAAnB;;AACA,MAAI,CAACZ,MAAL,EAAa;AACTA,IAAAA,MAAM,GAAG,MAAM,KAAKa,MAAL,CAAY;AAACb,MAAAA,MAAM,EAAEO,QAAT;AAAmBJ,MAAAA,KAAK,EAAE;AAA1B,KAAZ,CAAf;AACH;;AACD,SAAOH,MAAP;AACD,CANH;;AAQA,MAAMQ,KAAK,GAAGf,kBAASqB,KAAT,CAAe,OAAf,EAAwBhB,WAAxB,CAAd","sourcesContent":["import mongoose from 'mongoose';\n\nconst connectDb = () => {\n    return mongoose.connect(process.env.DATABASE_URL);\n};\n\nconst statsSchema = new mongoose.Schema({\n    domain: {\n        type: String\n    },\n    count: {\n        type: Number\n    }\n});\n\n/**\n * Increment the existing count for a domain or starts a new count\n */\nstatsSchema.statics.addOneOrCreate = async function addOneOrCreate(hostname) {\n    let domain = await Stats.findOneAndUpdate({domain: hostname}, { $inc: { count: 1 } }, {new: true, useFindAndModify: false });\n    if (!domain) {\n        domain = await this.create({domain: hostname, count: 1});\n    }\n    return domain;\n  };\n\nconst Stats = mongoose.model('Stats', statsSchema)\n\nexport { connectDb, Stats };"],"file":"db.js"}